{% extends "base.html" %}

{% block title %}Dashboard • Estuda AI{% endblock %}

{% block head %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

<style>
  /* === Estilo-base para o tema Estuda AI (Indigo/Roxo Tech) === */
  :root{
    --primary-color:#3f51b5; /* Indigo/Azul Profundo */
    --secondary-color:#7c4dff; /* Roxo Vibrante */
    --accent-color: #00bcd4; /* Ciano Elétrico (Destaque AI) */
    --bg-gradient-primary: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    --text-primary:#2d3436; --text-secondary:#636e72; --white:#fff;
    --radius-xl:1rem; --radius-2xl:1.5rem; --radius-full:9999px;
    --shadow-xl:0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
  }

  .btn-gradient {
      background: var(--bg-gradient-primary);
      color: var(--white);
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius-xl);
      transition: all 0.3s ease;
  }
  .btn-gradient:hover {
      box-shadow: var(--shadow-xl);
      transform: translateY(-2px);
      color: var(--white);
  }

  /* Novo Estilo para botão outline com gradient (para o botão Sair, agora) */
  .btn-outline-gradient {
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius-xl);
    background: transparent;
    border: 2px solid var(--primary-color);
    color: var(--primary-color);
    transition: all 0.3s ease;
  }
  .btn-outline-gradient:hover {
    background: var(--primary-color);
    color: var(--white);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transform: translateY(-1px);
  }


  /* Estilo Card Soft (para lista de resumos) */
  .card-soft {
    background-color: #f8f9fa; /* Um cinza bem claro */
    border: 1px solid #e9ecef;
    border-radius: var(--radius-xl);
    transition: all 0.2s ease;
  }
  .card-soft:hover {
    background-color: #fff;
    border-color: var(--primary-color);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
  }

  .pill {
    display: inline-flex;
    align-items: center;
    padding: 0.3rem 0.75rem;
    border-radius: var(--radius-full);
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--primary-color);
    background-color: #e0e7ff; /* light primary/indigo */
    border: 1px solid var(--primary-color);
  }

  .pill i {
    margin-right: 0.3rem;
  }

  .list-group-item:hover {
    background-color: #f8f9fa;
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">

  <div class="card-hero p-4 p-md-5 mb-5 rounded-4 shadow-sm" style="background:var(--bg-gradient-primary);" data-aos="fade-up">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h3 text-white fw-bold m-0">Olá, {{ usuario.nome.split(' ')[0] }}!</h1>
    </div>
    <p class="lead text-white-50">Bem-vindo(a) ao seu Dashboard Estuda AI. Gere resumos e testes com nossa inteligência artificial.</p>

    <div class="d-flex flex-wrap gap-2 mt-4">
      <a href="{{ url_for('novo_estudo') }}" class="btn-gradient"><i class="bi bi-cloud-upload"></i> Novo Estudo</a>
      <a href="{{ url_for('sair') }}" class="btn-outline-gradient"><i class="bi bi-box-arrow-right"></i> Sair</a>
    </div>
  </div>


<section class="section" data-aos="fade-up" data-aos-delay="150">
    <h2 class="h4 fw-bold mb-4" style="color: var(--text-primary);"><i class="bi bi-journals me-2"></i> Meus Materiais de Estudo</h2>

    {# Botoes de Acao (MANTIDOS) #}
    <div class="d-flex align-items-center justify-content-between mb-2">
      <h4 class="m-0">Seus últimos resumos</h4>
      <div class="d-flex gap-2">
        <a href="{{ url_for('painel_usuario') }}" class="btn-outline-gradient btn-sm">
          <i class="bi bi-clock-history"></i> Ver todos
        </a>
        <a href="{{ url_for('novo_estudo') }}" class="btn-gradient btn-sm">
          <i class="bi bi-magic"></i> Novo Estudo
        </a>
      </div>
    </div>


    {# Lista horizontal de estudos (AGORA USANDO DADOS REAIS: ultimos_estudos) #}
    {% if ultimos_estudos %}
      <div class="h-scroll">
        {% for estudo in ultimos_estudos %}
        <div class="card-soft p-3">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <div class="fw-bold">{{ estudo.titulo|truncate(35) }}</div>
              <div class="text-secondary small">
                Criado em: {{ estudo.data_criacao.strftime('%d/%m/%Y %H:%M') }}
              </div>
            </div>

            {% if estudo.status == 'pronto' %}
                <a href="{{ url_for('visualizar_estudo', estudo_id=estudo.id) }}" class="btn-outline-gradient btn-sm">Abrir</a>
            {% elif estudo.status == 'processando' %}
                <button class="btn btn-sm btn-outline-secondary" disabled>
                    <span class="spinner-border spinner-border-sm me-1" aria-hidden="true"></span>
                    Processando...
                </button>
            {% else %}
                <button class="btn btn-sm btn-outline-danger" disabled>Falha</button>
            {% endif %}
          </div>

          <div class="mt-2 d-flex flex-wrap gap-2">
            <span class="pill fw-bold" style="background:
              {% if estudo.status == 'pronto' %} var(--accent-light); border-color:var(--accent-color); color:var(--dark-color);
              {% elif estudo.status == 'processando' %} #ffebcc; border-color:#ff9900;
              {% else %} #fdd; border-color:#e74c3c;
              {% endif %};">
                <i class="bi bi-{{ 'check-circle' if estudo.status == 'pronto' else ('hourglass' if estudo.status == 'processando' else 'x-octagon') }}"></i>
                Status: {{ estudo.status|capitalize }}
            </span>

            {% if estudo.status == 'pronto' %}
                <span class="pill">
                    QCM: Pendente
                </span>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
        <div class="card-soft p-3 text-secondary">
            Você ainda não gerou nenhum resumo. Clique em <a href="{{ url_for('novo_estudo') }}" class="text-decoration-none fw-bold" style="color: var(--primary-color);">Novo Estudo</a> para começar!
        </div>
    {% endif %}
  </section>

</div>
{% endblock %}

{% block script %}
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
    AOS.init();
</script>
{% endblock %}