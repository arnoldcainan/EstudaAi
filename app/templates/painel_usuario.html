{% extends "base.html" %}

{% block title %}Dashboard ‚Ä¢ Estuda AI{% endblock %}

{% block head %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

<style>
  /* === Estilo-base para o tema Estuda AI (Indigo/Roxo Tech) === */
  :root{
    --primary-color:#3f51b5; /* Indigo/Azul Profundo */
    --secondary-color:#7c4dff; /* Roxo Vibrante */
    --accent-color: #00bcd4; /* Ciano El√©trico (Destaque AI) */
    --bg-gradient-primary: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    --text-primary:#2d3436; --text-secondary:#636e72; --white:#fff;
    --radius-xl:1rem; --radius-2xl:1.5rem; --radius-full:9999px;
    --shadow-xl:0 20px 25px rgba(0,0,0,.15); --shadow-lg:0 10px 15px rgba(0,0,0,.1);
  }
  body{ font-family:'Inter',system-ui,Segoe UI,Roboto,Arial,sans-serif; color:var(--text-primary); }

  /* HERO compacto do painel */
  .hero-panel{
    background: var(--bg-gradient-primary);
    color: var(--white);
    border-radius: var(--radius-2xl);
    padding: clamp(18px,3vw,28px);
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow-xl);
  }
  .hero-panel .glow{
    position:absolute; inset:auto -60px -60px auto;
    width:180px; height:180px; border-radius:50%;
    background: rgba(255,255,255,.18); filter: blur(4px);
  }
  .hero-title{
    font-family:'Poppins',sans-serif; font-weight:800; margin:0 0 .25rem;
    font-size: clamp(22px,3.2vw,34px); line-height:1.15;
  }
  .hero-sub{ opacity:.95; margin:0; }

  .chip{
    display:inline-flex; align-items:center; gap:.5rem;
    background: rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.35);
    color:#fff; padding:.45rem .75rem; border-radius: var(--radius-full);
    font-size:.9rem;
  }

  /* Grid de a√ß√µes */
  .grid{
    display:grid; gap:18px; margin-top:16px;
    grid-template-columns: repeat(auto-fit, minmax(230px,1fr));
  }
  .tile{
    background:#fff; border-radius: var(--radius-2xl);
    padding:16px; text-decoration:none; border:1px solid rgba(0,0,0,.06);
    box-shadow: var(--shadow-lg); transition: transform .18s ease, box-shadow .18s ease;
    display:flex; flex-direction:column; gap:10px; min-height:140px;
  }
  .tile:hover{ transform: translateY(-6px); box-shadow: var(--shadow-xl); }
  .tile .icon{
    width:56px; height:56px; border-radius:14px; display:grid; place-items:center;
    background: var(--bg-gradient-primary); color:#fff; font-size:1.4rem;
  }
  .tile h3{ font-family:'Poppins',sans-serif; font-size:1.1rem; font-weight:700; margin:0; }
  .tile p{ color:var(--text-secondary); margin:0; }

  /* Se√ß√µes listadas */
  .section{ margin-top:28px; }
  .section h4{ font-family:'Poppins',sans-serif; font-weight:700; margin:0 0 .75rem; }
  .card-soft{
    background:#fff; border:1px solid rgba(0,0,0,.06); border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
  }

  /* Lista horizontal responsiva */
  .h-scroll{
    display:grid; gap:14px; grid-auto-flow: column; grid-auto-columns: minmax(260px, 1fr);
    overflow-x:auto; padding-bottom:6px;
  }
  .h-scroll::-webkit-scrollbar{ height:8px; }
  .h-scroll::-webkit-scrollbar-thumb{ background:rgba(0,0,0,.15); border-radius:8px; }

  .pill{
    border-radius: var(--radius-full);
    padding:.25rem .6rem; font-size:.85rem;
    border:1px solid rgba(0,0,0,.08); background:#f8f9fa;
  }

  /* Ajuste dos Bot√µes para usar o novo Primary/Accent */
  .btn-gradient{
    background: var(--bg-gradient-primary); border:none; color:#fff; font-weight:700;
    border-radius: var(--radius-full); padding:.7rem 1.1rem; text-decoration:none;
    display:inline-flex; align-items:center; gap:.5rem; transition:.18s ease;
  }
  .btn-gradient:hover{ transform: translateY(-2px); box-shadow: var(--shadow-lg); color:#fff; }

  .btn-outline-gradient{
    border:2px solid var(--accent-color); color:var(--accent-color); /* Usando ACCENT para o outline */
    border-radius: var(--radius-full); padding:.6rem 1rem; font-weight:700; text-decoration:none;
    display:inline-flex; align-items:center; gap:.5rem; transition:.18s ease;
  }
  .btn-outline-gradient:hover{
    background: var(--bg-gradient-primary); color:#fff; transform: translateY(-2px);
  }

  @media (max-width: 576px){
    .grid{ grid-template-columns:1fr; }
    .h-scroll{ grid-auto-columns: 85%; }
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <section class="hero-panel" data-aos="fade-up">
    <div class="glow" aria-hidden="true"></div>
    <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3">
      <div class="d-flex align-items-center gap-3">
        <div style="width:66px;height:66px;border-radius:50%;overflow:hidden;border:2px solid rgba(255,255,255,.6);background:#f3f4f6">
          {% if usuario and usuario.foto_perfil %}
            <img src="data:image/png;base64,{{ usuario.foto_perfil }}" alt="Foto de perfil" style="width:100%;height:100%;object-fit:cover;">
          {% else %}
            <img src="{{ url_for('static', filename='images/user.png') }}" alt="Avatar padr√£o" style="width:100%;height:100%;object-fit:cover;">
          {% endif %}
        </div>
        <div>
          <h1 class="hero-title">Ol√°, {{ usuario.nome|capitalize }} üëã</h1>
          <p class="hero-sub">Seu hub de <strong>resumos</strong>, <strong>testes</strong> e <strong>evolu√ß√£o</strong>.</p>
        </div>
      </div>

      <div class="d-flex flex-wrap gap-2">
        <a href="#" class="btn-gradient"><i class="bi bi-cloud-upload"></i> Novo Estudo (Upload)</a>
        <a href="#" class="btn-outline-gradient"><i class="bi bi-person-gear"></i> Perfil</a>
      </div>
    </div>

    <div class="d-flex flex-wrap gap-2 mt-3">
      <span class="chip"><i class="bi bi-file-earmark-text"></i> Resumos Feitos: <b class="ms-1">{{ 7 }}</b></span>
      <span class="chip"><i class="bi bi-patch-question"></i> QCMs Conclu√≠dos: <b class="ms-1">{{ 15 }}</b></span>
      <span class="chip"><i class="bi bi-bar-chart-line"></i> Score M√©dio: <b class="ms-1">{{ 78 }}%</b></span>
      <span class="chip"><i class="bi bi-lightbulb"></i> T√≥picos Revistos: <b class="ms-1">{{ 3 }}</b></span>
    </div>
  </section>

  <section class="mt-3" data-aos="fade-up" data-aos-delay="100">
    <div class="grid">
      <a class="tile" href="#">
        <div class="icon"><i class="bi bi-cloud-arrow-up"></i></div>
        <h3>Upload de Arquivo</h3>
        <p>Inicie um novo estudo enviando seu PDF ou DOCX.</p>
      </a>

      <a class="tile" href="#">
        <div class="icon"><i class="bi bi-clock-history"></i></div>
        <h3>Hist√≥rico de Estudos</h3>
        <p>Acesse seus resumos e testes anteriores.</p>
      </a>

      <a class="tile" href="#">
        <div class="icon"><i class="bi bi-graph-up-arrow"></i></div>
        <h3>Meu Desempenho</h3>
        <p>Veja gr√°ficos e feedback sobre seus resultados nos QCMs.</p>
      </a>

      <a class="tile" href="#">
        <div class="icon"><i class="bi bi-chat-text"></i></div>
        <h3>Revisor Guiado</h3>
        <p>Fa√ßa perguntas abertas ao documento ap√≥s o resumo.</p>
      </a>
    </div>
  </section>

  <section class="section" data-aos="fade-up" data-aos-delay="150">
    <div class="d-flex align-items-center justify-content-between mb-2">
      <h4 class="m-0">Seus √∫ltimos resumos</h4>
      <div class="d-flex gap-2">
        <a href="#" class="btn-outline-gradient btn-sm">
          <i class="bi bi-clock-history"></i> Ver todos
        </a>
        <a href="#" class="btn-gradient btn-sm">
          <i class="bi bi-magic"></i> Novo Estudo
        </a>
      </div>
    </div>


    {# Lista horizontal de estudos (simulando dados) #}
    {% set ultimos_resumos_simulados = [
        {'id': 1, 'titulo': 'Introdu√ß√£o √† Arquitetura Serverless', 'data': '01/08/2025', 'paginas': 45, 'qcm_feito': True, 'score': 80},
        {'id': 2, 'titulo': 'Algoritmos de Criptografia Moderna (RSA)', 'data': '25/07/2025', 'paginas': 12, 'qcm_feito': False, 'score': None},
        {'id': 3, 'titulo': 'Fundamentos de LangChain e LLMs', 'data': '10/07/2025', 'paginas': 72, 'qcm_feito': True, 'score': 92}
    ] %}

    {% if ultimos_resumos_simulados %}
      <div class="h-scroll">
        {% for resumo in ultimos_resumos_simulados %}
        <div class="card-soft p-3">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <div class="fw-bold">{{ resumo.titulo|truncate(35) }}</div>
              <div class="text-secondary small">
                {{ resumo.data }} ‚Ä¢ {{ resumo.paginas }} P√°ginas
              </div>
            </div>
            <a href="#" class="btn-outline-gradient btn-sm">Abrir</a>
          </div>
          <div class="mt-2 d-flex flex-wrap gap-2">
            <span class="pill">
                <i class="bi bi-patch-question"></i> QCM: {{ 'Conclu√≠do' if resumo.qcm_feito else 'Pendente' }}
            </span>
            {% if resumo.score %}
                <span class="pill" style="background:var(--accent-light); border-color:var(--accent-color);">
                    Score: {{ resumo.score }}%
                </span>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
        <div class="card-soft p-3 text-secondary">
            Voc√™ ainda n√£o gerou nenhum resumo. Clique em <a href="{{ url_for('novo_estudo') }}" class="text-decoration-none fw-bold" style="color: var(--primary-color);">Novo Estudo</a> para come√ßar!
        </div>
    {% endif %}
  </section>

  </div>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>AOS.init({ duration:800, once:true, offset:100 });</script>
{% endblock %}